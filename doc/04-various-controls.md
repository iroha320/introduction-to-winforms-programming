第4章 様々なコントロールたち
=====

[↑目次](..\README.md "目次")

[←第3章 あなたのお名前は？](03-whats-your-name.md)

ここまでの章では、Label（ラベル）、Button（ボタン）、TextBox（テキストボックス）コントロールを使った簡単なアプリを作成し、Windows Forms アプリケーションの基本的な作り方を学んできました。しかし、実用的なアプリケーションにはもっと様々なコントロールが必要です。本章では、主に使われるコントロールについて、その特徴と使い方を学んでいきます。

## コントロールの基本

これまで学んできたLabel（ラベル）、Button（ボタン）、TextBox（テキストボックス）コントロールなどの各種コントロール、さらにはForm（フォーム）クラスも、実はすべて同じ型の派生型です。その型とは[System.Windows.Forms.Controlクラス](https://msdn.microsoft.com/ja-jp/library/system.windows.forms.control.aspx)（以下Controlクラス）です。

Controlクラスは前章で紹介した`Text`プロパティのような基本的なプロパティ、イベント、メソッドなどのメンバーを備えています。そのため、各種のコントロールをControlクラスの変数として共通的に扱うことができるようになっています。例えば、ForeColorプロパティを使えば、画面上のすべてのコントロールの文字色を一括して変更する、といったことができます。

これらのメンバーの主なものを簡単に紹介します。詳しくは上記リンク先のMSDNライブラリを参照してください。

### プロパティ

#### 見た目に関するもの

| 名前  | 説明 |
| --- | --- |
| BackColor（バックカラー） | 背景色を指定する |
| ForeColor（フォアカラー） | 前景色（文字の色）を指定する |
| Enabled（イネイブルド） | コントロールが有効かどうか指定する |
| Visible（ビジブル） | コントロールを表示するかどうか指定する |

#### 配置に関するもの
| 名前 | 説明 |
| --- | --- |
| Location（ロケーション） | コントロールの位置を指定する |
| Left（レフト） | コントロールの左からの位置を指定する |
| Top（トップ） | コントロールの上からの位置を指定する |
| Size（サイズ） | コントロールの大きさを指定する |
| Width（ウィドゥス） | コントロールの幅を指定する |
| Height（ハイト） | コントロールの高さを指定する |

#### 挙動に関するもの
| 名前 | 説明 |
| --- | --- |
| Text（テキスト） | コントロールに表示する文字列を指定する |
| TabIndex（タブインデックス） | Tabキーによるカーソルの移動順を指定する |

### メソッド

| 名前 | 説明 |
| --- | --- |
| Focus（フォーカス） | コントロールにカーソルを設定する |
| Show（ショウ） | コントロールを表示する |
| Hide（ハイド） | コントロールを隠す |

### イベント

| 名前 | 説明 |
| --- | --- |
| Click（クリック） | コントロールがクリックされたときに発生する |
| Enter（エンター） | コントロールにカーソルが設定されるときに発生する |
| Leave（リーブ） | コントロールからカーソルが外れるときに発生する |
| TextChanged（テキストチェンジド） | コントロールのTextプロパティが変更されたときに発生する |
| KeyDown（キーダウン） | コントロール上でキーが押されたときに発生する |

## 主なコントロール

基本を押さえたところで、今度は主なコントロールについてそれぞれ学んでいきましょう。各種コントロールの特徴を知るために作成したサンプルアプリケーションが「VariousControls」です（図4-1）。以後の説明はVisual Studioで「VariousControls」プロジェクトを開き、一緒に参照しながら学習を進めてください。

![VariousControlsサンプルアプリケーション](../image/04-01.jpg)

図4-1 VariousControlsサンプルアプリケーション

なお、今回は次のコントロールを取り上げます。他のコントロールについては別途Web検索等で調べてください。


- コモン コントロール
    - Label（ラベル）
    - Button（ボタン）
    - TextBox（テキストボックス）
    - CheckBox（チェックボックス）
    - RadioButton（ラジオボタン）
    - ListBox（リストボックス）
    - ComboBox（コンボボックス）
- コンテナー コントロール
    - Panel（パネル）
    - GroupBox（グループボックス）
    - TabControl（タブコントロール）
- データコントロール
    - DataGridView（データグリッドビュー）

### コモン コントロール

「ツールボックス」ウィンドウの「コモン コントロール」タブに含まれるコントロールです。基本的なユーザーとの対話で用いられるコントロール群で、最も使用機会が多いものです。

#### Label（ラベル）コントロール

テキストを表示するためのコントロールがLabel（ラベル）コントロールです（図4-2）。

![Labelコントロール](../image/04-02.jpg)

図4-2 Labelコントロール

Labelコントロールはこれまでの章でも何度も登場していますが、Controlクラスより継承したTextプロパティに表示したいテキスト文字列を設定して使います。

また、前背景色を変更したいときは、同じくControlクラスより継承したForeColor、BackColorプロパティに、System.Drawing.Color構造体の値を設定します。「フォームデザイナ」で設定するときは、「プロパティ」ウィンドウの該当項目にて、「カラーパレット」から選択できます（図4-3）。

![デザイナーでの色の選択](../image/04-03.jpg)

図4-3 デザイナーでの色の選択

#### Button（ボタン）コントロール

ユーザーからの何らかの処理の「実行」を引き受けるためのコントロールがButton（ボタン）コントロールです（図4-4）。

![Buttonコントロール](../image/04-04.jpg)

図4-4 Buttonコントロール

Buttonコントロールは第2章、第3章でも紹介した通り、Clickイベントハンドラーを記述することで、ユーザーからの何らかの処理の「実行」の引き金として使います。すでに前の章で説明した内容ですので、ここでの説明は以上とします。

#### TextBox（テキストボックス）コントロール

テキストを入力、表示するためのコントロールがTextBox（テキストボックス）コントロールです（図4-5）。

![TextBoxコントロール](../image/04-05.jpg)

図4-5 TextBoxコントロール

TextBoxコントロールは前章でも紹介しましたが、Labelコントロールと同様に、Controlクラスより継承したTextプロパティを使うことで、入力された文字列の取得、任意の文字烈の表示を行います。

##### 読取専用

TextBoxコントロールで特徴的なプロパティの一つに、ReadOnly（リードオンリー）プロパティ（bool型）があります。このプロパティはその名のとおり、`true`を設定することでテキストボックスを読取専用にすることができます（図4-6）。読取専用になったテキストボックスは、背景色が灰色となり、入力できないことが見た目で分かるように変更されます。

![ReadOnlyプロパティ](../image/04-06.jpg)

図4-6 ReadOnlyプロパティ

##### 文字の表示位置

数量や金額などの項目については、文字の表示位置を右詰めにしたいということがよくあります。そんなときはTextAlign（テキストアライン）プロパティを設定します（図4-7）。

![TextAlignプロパティ](../image/04-07.jpg)

図4-7 TextAlignプロパティ

TextAlignプロパティは`System.Windows.Forms.HorizontalAlignment`列挙体で、その値は次のものが選べます。

| 値 | 説明　|
| --- | --- |
| Center | 中央詰め |
| Left | 左詰め（既定値） |
| Right | 右詰め |

##### 入力文字数制限

入力できる文字数を制限するにはMaxLength（マックスレングス）プロパティ（int型）を設定します。

![MaxLengthプロパティ](../image/04-08.jpg)

図4-8 MaxLengthプロパティ

##### 複数行入力

TextBoxコントロールに複数行のテキストを入力させるときは、MultiLine（マルチライン）プロパティ（bool型）にtrueを設定します（図4-9）。

![MultiLineプロパティ](../image/04-09.jpg)

図4-9 MultiLineプロパティ

複数行入力可能にしたとき、フォームデザイナからTextプロパティに複数行のテキストを入力するには、「プロパティ ウィンドウ」でTextプロパティを選択すると表示されるボタンをクリックします。すると、入力用のテキストエリアが表示されるので、改行を含むテキストを入力後にCtrl+Enterキーで入力を確定します（図4-10）。

![フォームデザイナから複数行テキスト設定](../image/04-10.jpg)

図4-10 フォームデザイナから複数行テキスト設定

##### テキスト変更検知

TextBoxコントロールでよく使うイベントに「TextChanged（テキストチェンジド）」イベントがあります。このイベントは、Textプロパティの値がユーザーによる入力や、コードによる設定で変更されたとき発生します（変更前後のテキストが同じでも発生する）。このイベントを使うことで、例えば「入力文字数が5文字を超えたら警告メッセージを表示する」とったこともできます（リスト4-1、図4-11）。

リスト4-1 TextChangedイベントハンドラー（`Form1.cs`より）

```csharp
private void textBox1_TextChanged(object sender, EventArgs e)
{
    if (textBox1.Text.Length > 5)
    {
        MessageBox.Show("入力文字数が5文字を超えました");
    }
}
```

![入力文字数が5文字を超えた際のメッセージ](../image/04-11.jpg)

図4-11 入力文字数が5文字を超えた際のメッセージ

#### CheckBox（チェックボックス）コントロール

ユーザーにチェックオン／オフで選択させるためのコントロールがCheckBox（チェックボックス）コントロールです（図4-12）。

![CheckBoxコントロール](../image/04-12.jpg)

図4-12 CheckBoxコントロール

CheckBoxコントロールのチェックオン／オフの状態は、Checked（チェックド）プロパティ（bool型）で取得、設定します。また、チェックオン／オフの切り替えのタイミングで何か処理を行いたい場合は、CheckedChanged（チェックドチェンジド）イベントを使用します（リスト4-2、図4-13）。

リスト4-2 CheckBoxコントロールのCheckedChangedイベントハンドラー（`Form1.cs`より）

```csharp
private void checkBox1_CheckedChanged(object sender, EventArgs e)
{
    MessageBox.Show("チェック" + (checkBox1.Checked ? "オン" : "オフ"));
}
```

![チェック状態を変更時に表示（チェックオン）](../image/04-13-01.jpg) ![チェック状態を変更時に表示（チェックオフ）](../image/04-13-02.jpg)

図4-13 チェック状態を変更時に表示

#### RadioButton（ラジオボタン）コントロール

ユーザーにチェックオン／オフで選択させるためのコントロールがCheckBoxコントロールの他にもう一つあります。それがRadioButton（ラジオボタン）コントロールです（図4-14）。CheckBoxコントロールはコントロール単品でチェックオン／オフを選択するのに対して、RadioButtonでは、あるきまったいくつかの選択肢から、一つをチェックして選択させることが大きな違いです。

![RadioButtonコントロール](../image/04-14.jpg)

図4-14 RadioButtonコントロール

チェックオン／オフの状態はCheckBoxコントロールと同様に、Checkedプロパティで取得、設定ができます。ただし、RadioButtonコントロールは後述する「コンテナー コントロール」内に配置した複数のコントロールの内、一つだけしかチェックできないことに注意が必要です。

また、CheckedChangedイベントも、一つのRadioButtonコントロールのチェック状態を変更すると、関連する他のRadioButtonコントロールの分まで発生してしまいます。そのため、どのRadioButtonコントロールが選択されたかどうかは、それぞれのCheckedChangedイベントに共通のイベントハンドラーを登録し、イベントハンドラーの`sender`引数を使ってイベントが発生したコントロールがチェックされたかどうかを判定する必要があります（リスト4-3、図4-15、16）。

リスト4-3 RadioButtonコントロールのCheckedChangedイベントハンドラー（`Form1.cs`より）

```csharp
private void radioButton_CheckedChanged(object sender, EventArgs e)
{
    var rb = sender as RadioButton;
    if (rb.Checked)
    {
        MessageBox.Show(rb.Text);
    }
}
```

![RadioButtonのイベントハンドラー設定１](../image/04-15-01.jpg) ![RadioButtonのイベントハンドラー設定２](../image/04-15-02.jpg) ![RadioButtonのイベントハンドラー設定３](../image/04-15-03.jpg)

図4-15 RadioButtonのイベントハンドラー設定

![選択したRadioButtonのラベル表示１](../image/04-16-01.jpg) ![選択したRadioButtonのラベル表示２](../image/04-16-02.jpg) ![選択したRadioButtonのラベル表示３](../image/04-16-03.jpg)

図4-16 選択したRadioButtonのラベル表示

#### ListBox（リストボックス）コントロール

いくつかの選択肢を同時に表示し、その中から任意のものを1つまたは複数選択させるためのコントロールがListBox（リストボックス）コントロールです（図4-17）。

![ListBoxコントロール](../image/04-17.jpg)

図4-17 ListBoxコントロール

##### 選択肢の設定方法

ListBoxコントロールの選択肢は、プロパティウィンドウからItemsプロパティを選択し、表示される「…」ボタンをクリックして表示される、「文字列コレクションエディター」ダイアログを使って設定できます。このダイアログには、選択肢を改行区切りで入力します（図4-18）。

![文字列コレクションエディター表示](../image/04-18-01.jpg) ![文字列コレクションエディターダイアログ](../image/04-18-02.jpg)

図4-18 文字列コレクションエディターでの選択肢設定

選択肢には文字列以外のオブジェクトも設定できます。それにはコードからItemsプロパティのAddメソッドを使います（リスト4-4）。なお、Itemsプロパティは`System.Windows.Forms.ListBox.ObjectCollection`型であり、その項目はobject型のオブジェクトで管理されています。したがって、選択肢には格納されたオブジェクトのToStringメソッドの結果が表示されます。

リスト4-4 コードによる選択肢設定（`Form1.cs`より）

```csharp
class MyListItem
{
    public string Text { get; }
    public string Value { get; }

    public MyListItem(string text, string value)
    {
        Text = text;
        Value = value;
    }

    public override string ToString()
    {
        return $"{Value}:{Text}";
    }
}

private void Form1_Load(object sender, EventArgs e)
{
    listBox2.Items.Add(new MyListItem("複数選択可能", "01"));
    listBox2.Items.Add(new MyListItem("項目２", "02"));
    listBox2.Items.Add(new MyListItem("項目３", "03"));

    listBox3.Items.Add(new MyListItem("複数選択可能","01"));
    listBox3.Items.Add(new MyListItem("項目２", "02"));
    listBox3.Items.Add(new MyListItem("項目３", "03"));
}
```

##### 選択肢の「値」

選択肢項目は表示されるテキスト以外に、「値」を持つことができます。「値」を使うことで、画面に表示されたテキストに対応する「区分」、「コード」といったものをプログラムで扱いやすくなります。

「値」を持たせるためには、選択肢項目オブジェクトが持つプロパティの内、「値」として使いたいプロパティ名を、ValueMemberプロパティに設定します。同じように、表示したいプロパティ名はDisplayMemberプロパティに設定します（図4-19）。

![表示用、値用プロパティ名設定](../image/04-19.jpg)

図4-19 表示用、値用プロパティ名設定

##### 選択項目の判定

ListBoxコントロールで選択した項目については、次のようなプロパティを使って設定、取得できます。

| プロパティ名 | 説明　|
| --- | --- |
| SelectedIndex（セレクテッドインデックス） | 選択項目の0オリジンのインデックス値 |
| SelectedIndices（セレクテッドインダイシズ） | 複数選択時の0オリジンのインデックス値コレクション（取得のみ） |
| SelectedItem（セレクテッドアイテム） | 選択項目オブジェクト |
| SelectedItems（セレクテッドアイテムス） | 複数選択時の選択項目オブジェクトコレクション（取得のみ） |
| SelectedValue（セレクテッドバリュー） | 選択項目の値 |

これらの内、SelectedIndicesプロパティ、SelectedItemsプロパティはforeach文を使って要素を列挙するなどして使用します。

また、選択項目が変更されたことを検知するには、次のようなイベントを使います。

| イベント名 | 説明 |
| --- | --- |
| SelectedIndexChanged（セレクテッドインデックスチェンジド） | 選択項目インデックスが変更されたときに発生 |
| SelectedValueChanged（セレクテッドバリューチェンジド） | 選択項目値が変更されたときに発生 |

例えば、選択項目値が変更されたときに選択項目をメッセージボックスで表示するというようなことができます（リスト4-5）。

リスト4-5 選択肢変更時の処理（`Form1.cs`より）

```csharp
private void listBox1_SelectedIndexChanged(object sender, EventArgs e)
{
    MessageBox.Show(Convert.ToString(listBox1.SelectedItem));
}
```

##### 複数選択可否の設定方法

ListBoxコントロールの項目を複数選択できるかどうかは、SelectionMode（セレクションモード）プロパティで設定できます（図4-20）。

![SelectionModeプロパティ](../image/04-20.jpg)

図4-20 SelectionModeプロパティ

SelectionModeプロパティは`System.Windows.Forms.SelectionMode`列挙体で、その値は次のものが選べます。

| 値 | 説明　|
| --- | --- |
| None | 選択不可 |
| One | 一つだけ選択可（既定値） |
| MultiSimple | マウスを使って複数選択可 |
| MultiExtended | マウス及びCtrlキー、Shiftキー、カーソルキーを使って複数選択可 |

#### ComboBox（コンボボックス）コントロール

ドロップダウン形式のリストボックス、もしくは直接入力で選択肢を1つ選択させるためのコントロールがComboBox（コンボボックス）コントロールです（図4-16）。選択肢の設定方法や、選択された項目の判定方法などはListBoxコントロールと同様に行えます。

![ComboBoxコントロール](../image/04-21.jpg)

図4-21 ComboBoxコントロール

ComboBoxコントロールの項目をどのように選択させるかは、DropDownStyle（ドロップダウンスタイル）プロパティで設定できます（図4-22）。

![DropDownStyleプロパティ](../image/04-22.jpg)

図4-22 DropDownStyleプロパティ

DropDownStyleプロパティは`System.Windows.Forms.ComboBoxStyle`列挙体で、その値は次のものが選べます。

| 値 | 説明　|
| --- | --- |
| DropDown | テキスト入力と下向三角（▼）ボタンをクリックして表示される「ドロップダウンリスト」で選択（既定値） |
| DropDownList | テキスト入力できず、ドロップダウンリストでのみ選択 |
| Simple | テキスト入力とリストボックスで選択 |

### コンテナー コントロール

「ツールボックス」ウィンドウの「コンテナー」タブに含まれるコントロールです。その名のとおり、他のコントロールを収めるためのコントロール群です。

#### Panel（パネル）コントロール

最も基本的なコンテナーで、「枠」を提供します（図4-23）。アプリケーション画面をヘッダー部、明細部のように分けたりする際によく使われます。また、枠線なしのPanelコントロールは、いくつかのRadioButtonコントロールをグループ化するためにも使われます。

![Panelコントロール](../image/04-23.jpg)

図4-23 Panelコントロール

枠線の見た目はBorderStyle（ボーダースタイル）プロパティによって変更できます（図4-24）。

![BorderStyleプロパティ](../image/04-24.jpg)


図4-24 BorderStyleプロパティ

BorderStyleプロパティは`System.Windows.Forms.BorderStyle`列挙体で、その値は次のものが選べます。

| 値 | 説明　|
| --- | --- |
| None | なし（既定値） |
| FixedSingle | 一重線 |
| Fixed3D | 3D境界線 |

#### GroupBox（グループボックス）コントロール

ラベル付きの枠を提供するコンテナーです（図4-25）。画面上の項目をその名のとおりグループ分けするために使います。もちろんRadioButtonコントロール用のコンテナーとしてもよく使われます。

![GroupBoxコントロール](../image/04-25.jpg)

図4-25 GroupBoxコントロール

#### TabControl（タブコントロール）コントロール

複数ページを「タブ」で切り替えることのできるコンテナーです（図4-26）。タブのそれぞれのページは、「TabPage（タブページ）」コントロールとして追加し、このTabPageコントロールが実際のコンテナーになります。

![TabControlコントロール](../image/04-26.jpg)

図4-26 TabControlコントロール

タブの追加、削除などは、「プロパティ ウィンドウ」のTabPages（タブページス）プロパティに表示されるボタンを押して表示される、「TabPage コレクション エディター」から行います（図4-27）。

![TabPagesプロパティ](../image/04-27-01.jpg) ![TabPage コレクション エディター](../image/04-27-02.jpg)

図4-27 TabPage コレクション エディター

### データ コントロール

「ツールボックス」ウィンドウの「データ」タブに含まれるコントロールです。アプリケーションの「データ」を表示したり、入力したりするのをサポートしてくれるコントロール群がそろっています。

#### DataGridView（データグリッドビュー）コントロール

Excelスプレッドシートのような、グリッド形式でのデータ表示、入力をおこなうためのコントロールです（図4-28）。グリッドのセルにはテキスト以外にも、チェックボックスやボタン、ドロップダウンリストなどを使うこともできます。

![DataGrodViewコントロール](../image/04-28.jpg)

図4-28 DataGridViewコントロール

##### 列の編集

グリッドの列を編集するには、「プロパティ ウィンドウ」のColumns（カラムス）プロパティのボタンをクリックして表示される、「列の編集」ダイアログを使います（図4-29）。

![Columnsプロパティ](../image/04-29-01.jpg) ![「列の編集」ダイアログ](../image/04-29-02.jpg)

図4-29 「列の編集」ダイアログ

まず、列を追加するには「追加」ボタンをクリックして「列の追加」ダイアログを表示します（図4-30）。

![列の追加ボタン](../image/04-30-01.jpg) ![「列の追加」ダイアログ](../image/04-30-02.jpg)

図4-30 「列の追加」ダイアログ

必要な項目を入力て「追加」ボタンをクリックすると、「列の編集」ダイアログの「選択された列」欄に列が追加され、次の追加列情報を入力できます（図4-31）。

![追加列情報の入力](../image/04-31-01.jpg) ![列の追加](../image/04-31-02.jpg)

図4-31 列の追加

なお、「型」にはテキストボックスやボタンといった種類に応じたDataGridViewColumn型の派生型を指定できます（図4-32）。

![列の型](../image/04-32.jpg)

図4-32 列の型

既定で用意されている主な列の型は以下の通りです。

| 型名 | 説明 |
| --- | --- |
| DataGridViewTextBoxColumn（データグリッドビューテキストボックスカラム） | テキストボックスを使った値の表示、入力を行う（既定値） |
| DataGridViewButtonColumn（データグリッドビューボタンカラム） | 処理実行を受け付けるボタンを表示する |
| DataGridViewCheckBoxColumn（データグリッドビューチェックボックスカラム） | チェックボックスを使った値の表示、入力を行う |
| DataGridViewComboBoxColumn（データグリッドビューコンボボックスカラム） | コンボボックスを使った値の表示、入力を行う（ただし、既定ではドロップダウンリストによる選択のみで直接入力はできない） |

この作業を繰り返し、必要な列を追加していく（図4-33）。

![列の追加完了](../image/04-33.jpg)

図4-33 列の追加完了

##### 列のプロパティ設定

追加した列には、列の内容に応じた「幅」を設定してやる必要があります。そのためにはControl型と同様にWidthプロパティを設定します（図4-34）。

![列幅の設定](../image/04-34.jpg)

図4-34 列幅の設定

追加した列には列の型によって、コモン コントロールと同様の設定ができるものがあります。例えば、DataGridViewTextBoxColumn型なら、MaxLengthプロパティにより入力可能文字数を制限できます（図4-35）。

![テキストボックス列の入力可能文字数設定](../image/04-35.jpg)

図4-35 テキストボックス列の入力可能文字数設定

また、日付などを表示する際、その書式を指定することもできます。それにはまず、DefaultCellStyle（デフォルトセルスタイル）プロパティのボタンをクリックし、「CellStyle」ダイアログを表示します（図4-36）。

![DefaultCellStyleプロパティ設定](../image/04-36-01.jpg) ![CellStyleダイアログ](../image/04-36-02.jpg)

図4-36 DefaultCellStyleプロパティ設定

その後、CellStyleダイアログにて「動作」→「Format」プロパティに`"yyyy/MM/dd"`と設定します（図4-37）。このとき設定する「書式指定文字列」は、String.Formatメソッドに指定できるものと同じです。したがって、数値なら`"#,##0.00"`のように設定すれば、カンマ編集および小数点以下2桁固定表示で数値を表示できます。

![書式指定文字列設定](../image/04-37.jpg)

図4-37 書式指定文字列設定

DataGridViewComboBoxColumn型では、ComboBoxコントロールと同様に、Itemsプロパティをデザイナーから設定できます（図4-38）。

![DataGridViewComboBoxColumn型のItemsプロパティ](../image/04-38-01.jpg) ![DataGridViewComboBoxColumn型の選択肢入力](../image/04-38-02.jpg)

図4-38 DataGridViewComboBoxColumn型の選択肢入力

DataGridViewButtonColumn型なら、ボタンに表示するテキストをTextプロパティに設定後、UseColumnTextForButtonValueプロパティ（bool型）にtrueを設定することで、全部の列で同じテキストをボタンに表示できます（図4-39）。

![ボタンの表示テキスト設定](../image/04-39.jpg)

図4-39 ボタンの表示テキスト設定




このようにして列のプロパティ設定を行ってフォームデザイナーを表示すると、設定した列情報が見た目に反映されます（図4-40）。

![列設定後のDataGridViewコントロール](../image/04-40.jpg)

図4-40 列設定後のDataGridViewコントロール

##### データの表示

DataGridViewコントロールにデータを表示する方法は大きく2つあります。一つは直接設定する方法、もう一つはデータバインドを用いる方法です。ここでは直接設定する方法について説明します。データバインドを用いる方法については、別途Web検索などで調べてください。

データを直接設定して表示するのは、リスト4-6のようなコードで行います。

リスト4-6 DataGridViewへのデータ直接設定（`Form1.cs`のForm.Loadイベントハンドラーより）

```csharp
// 行追加
dataGridView1.Rows.Add();
// 編集対象行取得
var row = dataGridView1.Rows[0];
// 行データ設定
row.Cells[0].Value = "00001";
row.Cells[1].Value = "鈴木 一郎";
row.Cells[2].Value = "男";
row.Cells[3].Value = new DateTime(2016, 4, 1);
row.Cells[4].Value = false;
```

まず、表示するデータ数の行を追加してやる必要があります。これにはRows（ロウズ）プロパティのAdd（アッドメソッド）を使います。

次に編集対象となる行オブジェクト（DataGridViewRow型）を取得します。これには。Rowsプロパティに対象行インデックスを指定して取得します。

最後に、取得した行オブジェクトの各セルに値を設定していきます。これにはDataGridViewRow.Cells（セルズ）プロパティに対象列インデックスを指定してセルオブジェクト（DataGridViewCell型）を取得後、そのValue（バリュー）プロパティ（object型）に値を設定します。

このとき、コンボボックス型セルへの設定は、ComboBoxコントロールのようにSelectedIndexプロパティがないため、あくまで「値」で設定する必要があるということです。もちろん、ComboBoxコントロールのようにValueMemberプロパティを設定していれば、サンプルコードのように`"男"`のような表示文字列ではなく、内部のコード値で指定することも可能です。

以上のような手順を踏むことで、DataGridViewコントロールにデータを表示することができます（図4-41）。

![列設定後のDataGridViewコントロール](../image/04-41.jpg)

図4-41 DataGridViewコントロールへのデータ表示


##### ボタンのクリック

グリッド内のボタンクリックを検知するには、CellContentClick（セルコンテントクリック）イベントを使います（リスト4-7）。

リスト4-7 DataGridViewコントロールのボタンクリック処理（`Form1.cs`より）

```csharp
private void dataGridView1_CellContentClick(object sender, DataGridViewCellEventArgs e)
{
    if (e.RowIndex < 0 || e.ColumnIndex != 5)
    {
        // 削除ボタン以外は処理終了
        return;
    }

    ...(略)...
}
```

CellContentClickイベントは「セルの内部要素をクリック」したタイミングで発生します。したがって、ボタン以外のセルをクリックしたときでもイベント自体は発生します。ですので、イベント引数（DataGridViewCellEventArgs型）のColumnIndex（カラムインデックス）プロパティ（int型）、RowIndex（ロウインデックス）プロパティ（int型）を使い、ボタンのセルかどうかを判定してから、処理を行う必要があります。

この考えはDataGridViewコントロールの他のイベントでも同様です。処理対象の列、行であるかを判定してから処理を行うということを忘れないでください。


##### データの取得

DataGridViewコントロールのデータを取得するには、前述のセルのValueプロパティを使います（リスト4-8）。

リスト4-8 DataGridViewよりデータ取得（`Form0.cs`のDataGridView.CellContentClickイベントハンドラーより）

```csharp
// 削除ボタンを押した行データを取得
var row = dataGridView1.Rows[e.RowIndex];
var employee = new
{
    Id = row.Cells[0].Value as string,
    Name = row.Cells[1].Value as string,
    Gender = row.Cells[2].Value as string,
    HireDate = (DateTime)row.Cells[3].Value,
    Suspended = (bool)row.Cells[4].Value
};
```

このときの注意点としては、Valueプロパティの型はobject型なので、実際に使用する際には、もともとの型にキャストしてから使う必要があるということです。`(型名)`というキャスト演算子や、文字列型などの参照型では`as`演算子を使うのもよいでしょう。

このようにしてデータ取得して、メッセージボックスにその値を表示する、といったことができます（図4-42）。

![行データの表示](../image/04-42.jpg)

図4-42 行データの表示


以上で簡単なアプリケーションであれば各種コントロールを使って作れるようになったかと思います。次の章では、そのコントロールで扱うデータをどのように管理するか学んでいきます。

[→ 第5章 クリック！クリック！](05-click-click.md)
