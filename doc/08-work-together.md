第8章 一緒にやろう
=====

[↑目次](..\README.md "目次")

[← 第7章 貴方にお任せ](07-leave-it-to-you.md)

前の章ではモーダル表示による複数画面連携の方法について学びました。本章では、モードレス表示による複数画面連携の手順について学んでいきましょう。

## アプリ概要

本章で扱うサンプルアプリは2つの画面で構成されています。

一つはメイン画面で、リストボックスに商品情報を表示してあり、商品名による絞り込みを行えます（図8-1）。

![メイン画面](../image/08-01.jpg)

図8-1 メイン画面

もう一つは商品情報表示画面で、アプリケーション起動時にメイン画面と一緒に表示されます。この画面にはメイン画面のリストボックスで選択した商品の商品コード、商品名、メーカー名を表示します（図8-2）。また、メイン画面で商品を選択しなおすたびに、商品情報は再表示されます。

![商品情報表示画面](../image/08-02.jpg)

図8-2 商品情報表示画面

メイン画面を閉じると、商品情報画面も閉じてアプリケーションが終了します。


## モードレス表示

子画面をモードレス表示するには、対象となる画面のフォームクラスのインスタンスを作成し、そのShowメソッドを呼び出します。このとき、子画面のインスタンスをローカル変数として宣言すると、メソッド終了時に変数が破棄され、子画面がすぐに閉じてしまいます。したがって、子画面は親画面などのフィールドとして保持する必要があります（リスト8-1）。
w


リスト8-1 モードレス表示（`MainForm.cs`より）

```csharp
private ProductForm productForm;

private void MainForm_Load(object sender, EventArgs e)
{
    productForm = new ProductForm
    {
        StartPosition = FormStartPosition.Manual,
        Left = this.Left + this.Width + 20,
        Top = this.Top
    };

    FilterProducts(productNameTextBox.Text);
}

private void MainForm_Shown(object sender, EventArgs e)
{
    productForm.Show();
}
```

サンプルではアプリケーション起動時にメイン画面と一緒に商品情報表示画面を開くため、まず親画面のLoadイベントハンドラーで子画面のインスタンスを作成（および初期位置設定）してフィールドに格納します。次に、親画面表示時に発生するShown（ショウン）イベントハンドラーにて、子画面インスタンスのShowメソッドを呼び出して、子画面を表示しています。

子画面のインスタンスはフィールドとして保持しているため、親画面を閉じるときに一緒に閉じる必要があります。そのため、親画面を閉じるときに発生するFormClosing（フォームクロージング）イベントにて、子画面インスタンスのClose（クローズ）メソッドを呼び出し、子画面を閉じるようにします（リスト8-2）。

リスト8-2 子画面を閉じる（`MainForm.cs`より）

```csharp
private void MainForm_FormClosing(object sender, FormClosingEventArgs e)
{
    productForm?.Close();
}
```

なお、子画面インスタンスのHide（ハイド）メソッドを呼び出すことで、画面を閉じるのではなく「隠す」こともできます。画面の状態を残したまま、一時的に画面を見えなくするようなときには、こちらのメソッドを使いましょう。再度画面を表示するには、Showメソッドを呼び出せばよいです。ただしこのとき、Shownイベントが発生するので、画面を初めて表示したときに行いたい処理は、ShownイベントハンドラーではなくLoadイベントハンドラーに書くようにしましょう。


## 子画面への受け渡し

設定専用プロパティ

